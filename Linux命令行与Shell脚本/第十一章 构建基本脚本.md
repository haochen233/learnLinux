## 11.1 使用多个命令  
shell脚本的关键在于输入多个命令并处理每个命令的结果，甚至需要将一个命令的结果传给另一个命令。shell可以让你将多个命令串起来，一次执行完成。如果要两个命令一起运行，可以把它们放在同一行中，彼此间用分号隔开。  

例如：  $ command1 ; command2  

## 11.2 创建shell脚本  
在创建shell脚本文件时，必须在文件的第一行指定要使用的shell。其格式为：  
**#!/bin/bash**  
在通常的shell脚本中，使用井号（#）注释。但是shell脚本的第一行是一个例外，#后面的感叹号（!）会告诉shell用哪个版本的shell来运行脚本。  
这就是第一行的特殊之处。  

## 11.3显示消息

1. echo命令  
    echo命令可以使用单引号或双引号划定字符串。  
    如果想把文本字符串和命令输出显示在同一行（即echo不换行），可以加上-n参数。  

## 11.4 使用变量  
变量允许你临时性地将信息存储在shell脚本中，以便和脚本中的其他命令一起使用。  

### 11.4.1 环境变量 
在脚本中，你可以在环境变量名称之前加上美元符（$）来使用这些环境变量，还可以这样引用 ${variable}。  
有时在shell中并不希望shell解读$符，可以在$前加上反斜线（\）,意味$符号本身。  

### 11.4.2 用户变量  
用户变量可以是任何由字母、数字或下划线组成的文本字符串，长度不超过20个字符。区分大小写。  
使用等号将值赋给用户变量。在变量、等号和值之间不能出现空格。  
例如：  
    var1=10
    var2='hello world'
    var3=haha

shell脚本会自动决定变量值的数据类型。在脚本的整个生命周期里，shell脚本中定义的变量会一直保持着它们的值，但在shell脚本结束时会被删除掉。  

与系统变量类似，用户变量可通过美元符引用。  

### 11.4.3 命令替换 
shell脚本中最有用的特性之一就是可以从命令输出中提取信息，并将其赋给变量。把输出赋给变量之后，就可以随意在脚本中使用了。这个特性在处理脚本数据时尤为方便。  

有两种方法可以将命令输出赋给变量：  
1. 反引号符号（`）
2. $( ) 格式  

命令替换允许你将shell命令的输出赋给变量。它是脚本编程中的一个主要组成部分。  

例如：  
用一对反引号把整个命令行命令围起来：  
    testing='date'  
要么使用$( )格式：  
    testing=$(date)  

`date +%y%m%d`将日期显示为两位数的年月日组合。  
例如 显示为200216，即2020年02月16日。  

注意！命令替换会创建一个子shell来运行对应的命令。


## 11.5 重定向输入和输出

### 11.5.1输出重定向
用大于号（>）来完成。  
command > outputfile 
运行command，原本会输出在屏幕的文字，会被保存到指定文件中。  
如果文件不存在，则创建。如果已存在该文件，则会将原本数据覆盖。  
如果不想被覆盖，可以使用>> 远大于符号追加到指定文件后。  

### 11.5.2 输入重定向
command < inputfile ,原本comamnd从标准输入读取（即用户命令），但是现在会从文件中读取。  

内联输入重定向：<< 远小于号。必须指定一个文本来划分输入数据的开始和结尾。  


## 11.6 管道
管道符 是竖线（|）。  
用法如下：  
command1 | command2  
不要以为由管道串起的两个命令会依次执行。Linux系统实际上会同时运行这两个命令，在系统内部将它们连接起来。在第一个命令产生输出的同时，输出会被立即送给第二个命令。数据
传输不会用到任何中间文件或缓冲区。  

## 11.7 执行数学运算
对shell脚本来说，这
个处理过程会比较麻烦。  

### 11.7.1 expr命令
$ expr 1 + 5
6

$ expr 2 * 5
syntax error
因为*被shell错误的解释了，所以需要在*号前加上反斜线。  

要将数学运算的结果赋给一个变量，需要使用命令替换来获取expr命令的输出

### 11.7.2 使用方括号
在bash中，在将一个数学运算结果赋给某个变量时，可以用美元符和方括号（$[ operation ]）将数学表达式围起来。 例如：  
`var1=$[1 + 5]`将运算1+5的结果，并将结果赋给变量var1。  
同时用方括号来计算公式时，不用担心shell会误解乘号或其他符号。  
bash shell数学运算符只支持整数运算。  

### 11.7.3 浮点解决方案
最常见的方案是用内建的bash计算器，叫做bc。  

1. bc的基本用法  
ash计算器实际上是一种编程语言，它允许在命令行中输入浮点表达式，然后解释并计算该表达式，最后返回结果。bash计算器能够识别：  
    - 数字（整数和浮点数）  
    - 变量（简单变量和数组）  
    - 注释（以#或以/**/）  
    - 表达式  
    - 编程语句（例如if-then语句）  
    -函数  

以在shell提示符下通过bc命令访问bash计算器： 
退出bc请输入quit。  

`bc -q`可以不显示进入bc的冗长的欢迎信息。  

在bc中精度scale默认为0。进入bc后输入`scale=4`,现在默认的精度就是小数点后4位了。  
而且支持变量，定义变量与shell一样，使用print可以打印变量的和数字

例如：  
```shell
var1=3.14
print var1
3.14
```  

2. 在脚本中使用bc  
可以用命令替换运行bc命令，并将输出赋给一个变量。格式入下：  
`var=$(echo "options; expression" | bc)`  

例如下例表达式可以为脚本中的变量的值（即$val_name）。  
如果需要的表达式太多。太长，还可以对bc使用内联重定向。  
例如：  
```
var1=$(bc << EOF
options
expression
EOF
)
```
## 11.8 退出脚本
shell中运行的每个命令都使用退出状态码（exit status）告诉shell它已经运行完毕。退出状态码是一个0～255的整数值，在命令结束运行时由命令传给shell。可以捕获这个值并在脚本中使用。  

### 11.8.1 查看退出状态码
Linux提供了一个专门的变量$?来保存上个已执行命令的退出状态码。  
使用 echo $? 来查看退出状态码。  
按照惯例，一个成功结束的命令的退出状态码是0。如果一个命令结束时有错误，退出状态就是一个正数值。  

Linux退出状态码：   
- 0  命令成功结束
- 1  一般性未知错误 
- 2  不适合的shell命令 
- 126  命令不可执行 
- 127  没找到命令
- 128  无效的退出参数
- 128+x  与Linux信号x相关的严重错误
- 130  通过Ctrl+C终止的命令
- 255  正常范围之外的退出状态码  

### 11.8.2 exit命令
默认情况下，shell脚本会以脚本中的最后一个命令的退出状态码退出。 
你可以改变这种默认行为，返回自己的退出状态码。exit命令允许你在脚本结束时指定一个退出状态码。你要注意这个功能，因为退出状态码最大只能是255。  

extra knowledge：

“source filename”与“sh filename”、“./filename”这三个命令都可以用于执行一个脚本文件，那么它们之间的区别又如何呢？

**比较：**  

- 当shell脚本具有可执行权限时，用sh filename与./filename是没有区别的。./filename是因为当前目录没有在PATH中，所以"."是用来表示当前目录的。

- sh filename会重新建立一个子shell，在子shell中执行脚本里面的语句，该子shell继承父shell的环境变量，但子shell是新建的，其改变的变量不会被带回父shell，除非使用export。

- source filename读取脚本里面的语句依次在当前shell里面执行，没有建立新的子shell。那么脚本里面所有新建、改变变量的语句都会保存在当前shell里面。

**source**命令是bash shell的内置命令。而点命令（即“**.**”命令）则是**source**的另一名称。这两个命令都以一个脚本为参数，该脚本将作为当前shell的环境执行，即不会启动一个新的子进程。所有在脚本中设置的变量将成为当前Shell的一部分。  

所以**source**命令通常用于重新执行刚修改的初始化文件，使之立即生效，而不必注销并重新登录。